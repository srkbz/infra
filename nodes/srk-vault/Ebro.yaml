environment:
  STATE_DIR: "${EBRO_ROOT}/.state"
  CACHE_DIR: "${EBRO_ROOT}/.cache"
  DATA_DIR: "/data"

imports:
  utils: { from: "../../modules/utils" }
  apt: { from: "../../modules/apt" }
  discover: { from: "../../modules/discover" }
  base-dirs: { from: "../../modules/base-dirs" }
  cron: { from: "../../modules/cron" }
  docker: { from: "../../modules/docker" }

tasks:
  default:
    requires: [discover, base-dirs, data-dir]

  data-dir:
    extends: [":utils:dir"]
    requires: [data-user]
    required_by: [base-dirs]
    environment:
      DIR: "${DATA_DIR}"
      PERM: "770"
      OWNERS: "data:data"

  data-user:
    extends: [":utils:user"]
    environment:
      NAME: data

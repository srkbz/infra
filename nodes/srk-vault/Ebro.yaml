environment:
  STATE_DIR: "${EBRO_ROOT}/.state"
  CACHE_DIR: "${EBRO_ROOT}/.cache"

imports:
  discover: { from: "../../discover" }

tasks:
  dirs:
    required_by: [discover]
    quiet: true
    script: |
      mkdir -p "${STATE_DIR}"
      mkdir -p "${CACHE_DIR}"
      chmod 700 "${STATE_DIR}"
      chmod 700 "${CACHE_DIR}"
    when:
      check_fails: |
        test -d "${STATE_DIR}"
        test -d "${CACHE_DIR}"
        [ "$(stat --format '%a' "${STATE_DIR}")" == "700" ]
        [ "$(stat --format '%a' "${CACHE_DIR}")" == "700" ]

  default:
    requires: [dirs, discover]

  example:
    labels:
      autorequire: "true"
    script: echo Hello world

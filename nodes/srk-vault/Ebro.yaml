environment:
  STATE_DIR: "${EBRO_ROOT}/.state"
  CACHE_DIR: "${EBRO_ROOT}/.cache"
  DATA_DIR: "/data"

imports:
  utils: { from: "../../modules/utils" }
  apt: { from: "../../modules/apt" }
  discover: { from: "../../modules/discover" }
  base-dirs: { from: "../../modules/base-dirs" }
  wireguard: { from: "../../modules/wireguard" }
  vpn: { from: "../../modules/vpn" }
  cron: { from: "../../modules/cron" }
  docker: { from: "../../modules/docker" }
  dropbox: { from: "../../modules/dropbox" }

tasks:
  default:
    labels:
      apt.packages: "vim htop btop iftop iotop"
    requires: [discover]

  data-dir:
    labels:
      discover: "true"
    extends: [":utils:dir"]
    requires: [data-group]
    required_by: [base-dirs]
    environment:
      DIR: "${DATA_DIR}"
      PERM: "770"
      OWNERS: "${USER}:data"

  data-group:
    labels:
      discover: "true"
    extends: [":utils:group"]
    environment:
      NAME: data

  dropbox-user-in-data-group:
    labels:
      discover: "true"
    requires: [data-group, ":dropbox:user"]
    extends: [":utils:user-in-group"]
    environment:
      USER_NAME: dropbox
      GROUP_NAME: data
